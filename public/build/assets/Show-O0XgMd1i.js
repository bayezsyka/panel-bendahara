import{r as x,u as A,R as oe,j as e,H as le,a as S}from"./app-Bey3Fxpz.js";import{B as de,S as O}from"./BendaharaLayout-Ch5jNDJS.js";import{P as ce}from"./PageHeader-BpAbHm1P.js";import{D as B,a as me}from"./Dropdown-DAZnkUGx.js";import{M}from"./Modal-BWhHWLD4.js";import{I as c}from"./InputLabel-5149DyC9.js";import{T as g}from"./TextInput-CSad3_Cs.js";import{P as J}from"./PrimaryButton-pmdbP0_O.js";import{S as q}from"./SecondaryButton-xwrqrr77.js";import{I as y}from"./InputError-BQKVErAs.js";import{S as xe}from"./SearchInput-De7kxTqb.js";/* empty css            */import"./ApplicationLogo-BytXWDQF.js";import"./transition-DmnHSn5V.js";import"./use-sync-refs-Dioybri5.js";import"./keyboard-Cb1nShGT.js";import"./with-selector-Do-EdSva.js";const i=[];for(let a=0;a<256;++a)i.push((a+256).toString(16).slice(1));function ue(a,n=0){return(i[a[n+0]]+i[a[n+1]]+i[a[n+2]]+i[a[n+3]]+"-"+i[a[n+4]]+i[a[n+5]]+"-"+i[a[n+6]]+i[a[n+7]]+"-"+i[a[n+8]]+i[a[n+9]]+"-"+i[a[n+10]]+i[a[n+11]]+i[a[n+12]]+i[a[n+13]]+i[a[n+14]]+i[a[n+15]]).toLowerCase()}let H;const ge=new Uint8Array(16);function he(){if(!H){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");H=crypto.getRandomValues.bind(crypto)}return H(ge)}const pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:pe};function ye(a,n,b){a=a||{};const l=a.random??a.rng?.()??he();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,ue(l)}function R(a,n,b){return K.randomUUID&&!a?K.randomUUID():ye(a)}const f=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),be=({project:a,expenseTypes:n})=>{const{setOpen:b}=x.useContext(me),[l,N]=x.useState(""),L=()=>{window.open(route("projectexpense.projects.export",{project:a.slug||a.id}),"_blank"),b(!1)},u=()=>{if(!l){alert("Pilih tipe biaya terlebih dahulu");return}window.open(route("projectexpense.projects.export",{project:a.slug||a.id,expense_type_id:l}),"_blank"),b(!1)};return e.jsxs(B.Content,{closeOnClick:!1,width:"64",children:[e.jsx("div",{className:"block px-4 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Export Laporan"}),e.jsx(B.Link,{as:"button",onClick:L,className:"w-full text-left",children:"PDF (Semua Kategori)"}),e.jsx("div",{className:"border-t border-gray-100 my-1"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-400 uppercase tracking-wider",children:"Export Per Tipe Biaya"}),e.jsxs("select",{value:l,onChange:h=>N(h.target.value),className:"block w-full rounded-lg border-gray-200 py-1.5 text-sm focus:border-indigo-500 focus:ring-indigo-500 shadow-sm",children:[e.jsx("option",{value:"",children:"Pilih Tipe Biaya"}),n.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),e.jsxs("button",{onClick:u,className:"w-full inline-flex justify-center items-center rounded-lg bg-indigo-600 px-3 py-2 text-xs font-bold text-white shadow-sm hover:bg-indigo-500 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export Tipe Biaya"]})]})]})};function qe({project:a,mandors:n,benderas:b,expenseTypes:l,allExpenseTypes:N}){const[L,u]=x.useState(!1),[h,k]=x.useState(!1),[D,C]=x.useState(null),[j,U]=x.useState("transacted_at"),[W,Y]=x.useState(""),v=a.status==="completed",Q=a.expenses.reduce((t,s)=>t+parseFloat(s.amount),0),{data:d,setData:m,post:G,processing:z,errors:_,reset:F}=A({project_id:a.id,expense_type_id:"",title:"",transacted_at:new Date().toISOString().split("T")[0],description:"",receipt_image:null,items:[{name:"",quantity:1,price:0}],idempotency_key:R()}),[V,T]=x.useState(!1),X=d.items.reduce((t,s)=>t+s.quantity*s.price,0),r=A({name:a.name,description:a.description||"",status:a.status,coordinates:a.coordinates||"",mandor_id:a.mandor_id||"",mandor_ids:a.mandors?a.mandors.map(t=>t.id):a.mandor_id?[a.mandor_id]:[],bendera_id:a.bendera_id||"",location:a.location||""}),$=a.expenses.filter(t=>{const s=W.toLowerCase();return t.title?.toLowerCase().includes(s)||t.description?.toLowerCase().includes(s)||t.expense_type?.name?.toLowerCase().includes(s)||t.items&&t.items.some(o=>o.name?.toLowerCase().includes(s))}).sort((t,s)=>{const o=new Date(t[j]);return new Date(s[j])-o}),[p,P]=x.useState(null),I=d.items.length>0?d.items[0].name:"";oe.useEffect(()=>{!V&&!p&&I&&m("title",I)},[I,V,p]);const Z=()=>{m("items",[...d.items,{name:"",quantity:1,price:0}])},ee=t=>{const s=d.items.filter((o,w)=>w!==t);m("items",s)},E=(t,s,o)=>{const w=[...d.items];w[t][s]=o,m("items",w)},te=()=>{P(null),m({project_id:a.id,expense_type_id:"",title:"",transacted_at:new Date().toISOString().split("T")[0],description:"",receipt_image:null,items:[{name:"",quantity:1,price:0}],idempotency_key:R()}),T(!1),u(!0)},ae=t=>{P(t.id),m({project_id:a.id,expense_type_id:t.expense_type_id||"",title:t.title,transacted_at:t.transacted_at,description:t.description||"",receipt_image:null,items:t.items.map(s=>({name:s.name,quantity:s.quantity,price:s.price}))}),T(!0),u(!0)},se=t=>{t.preventDefault(),p?S.post(route("projectexpense.expenses.update",p),{_method:"put",...d},{onSuccess:()=>{u(!1),F(),P(null)},preserveScroll:!0,forceFormData:!0}):G(route("projectexpense.expenses.store"),{onSuccess:()=>{u(!1),F(),m(s=>({...s,idempotency_key:R()}))},forceFormData:!0})},re=t=>{t.preventDefault(),r.put(route("projectexpense.projects.update",a.slug||a.id),{onSuccess:()=>k(!1)})},ne=t=>{O.fire({title:"Hapus Pengeluaran?",text:"Data pengeluaran ini akan dihapus permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal"}).then(s=>{s.isConfirmed&&S.delete(route("projectexpense.expenses.destroy",t))})},ie=()=>{O.fire({title:"Hapus Proyek?",html:`<p class="text-gray-600">Proyek <strong>${a.name}</strong> beserta seluruh data pengeluaran akan dihapus permanen.</p>`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Proyek",cancelButtonText:"Batal",customClass:{popup:"rounded-xl",confirmButton:"rounded-lg",cancelButton:"rounded-lg"}}).then(t=>{t.isConfirmed&&S.delete(route("projectexpense.projects.destroy",a.slug||a.id))})};return e.jsxs(de,{children:[e.jsx(le,{title:`Proyek: ${a.name}`}),e.jsx(ce,{title:a.name,backLink:route("projectexpense.projects.index"),backLabel:"Daftar Proyek",badge:{text:v?"Selesai":"Berjalan",variant:v?"green":"blue"},meta:e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[a.bendera&&e.jsxs("div",{className:"inline-block px-2 py-0.5 rounded text-[10px] font-bold tracking-wide uppercase bg-purple-100 text-purple-700 w-fit",children:["ðŸ¢ ",a.bendera.name]}),a.mandors&&a.mandors.length>0?e.jsx("div",{className:"space-y-1",children:a.mandors.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Pelaksana ",s+1,":"," ",e.jsx("span",{className:"font-medium text-gray-900",children:t.name})]},t.id))}):a.mandor&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Pelaksana:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:a.mandor.name})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),a.location]})]}),actions:e.jsxs("div",{className:"flex items-center gap-2",children:[!v&&e.jsx("button",{onClick:()=>k(!0),className:"p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition",title:"Edit Proyek",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:ie,className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition",title:"Hapus Proyek",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("div",{className:"w-px h-6 bg-gray-200 mx-1"}),e.jsxs(B,{children:[e.jsx(B.Trigger,{children:e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-50 shadow-sm text-sm",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export",e.jsx("svg",{className:"ml-1 h-4 w-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),e.jsx(be,{project:a,expenseTypes:l})]}),v?e.jsx("div",{className:"px-3 py-2 bg-gray-100 text-gray-500 font-medium rounded-lg border border-gray-200 cursor-not-allowed text-sm",children:"Terkunci"}):e.jsxs("button",{onClick:te,className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 shadow-sm text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Catat Pengeluaran"]})]})}),(a.description||a.coordinates)&&e.jsxs("div",{className:"mb-6 bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[a.description&&e.jsx("p",{className:"text-gray-600 mb-4",children:a.description}),a.coordinates&&e.jsxs("div",{className:"rounded-lg overflow-hidden border border-gray-200 shadow-sm bg-gray-100",children:[e.jsx("iframe",{width:"100%",height:"200",frameBorder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:`https://maps.google.com/maps?q=${encodeURIComponent(a.coordinates)}&hl=id&z=14&output=embed`}),e.jsxs("div",{className:"p-2 bg-white flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500 truncate max-w-[200px]",children:a.coordinates}),e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.coordinates)}`,target:"_blank",rel:"noreferrer",className:"text-indigo-600 font-medium hover:underline",children:"Buka di Maps â†’"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-sm font-medium",children:"Total Pengeluaran"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:f(Q)})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-sm font-medium",children:"Jumlah Transaksi"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:[a.expenses.length," Nota"]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-gray-500 text-sm font-medium",children:"Terakhir Update"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.expenses.length>0?new Date(a.expenses[0].transacted_at).toLocaleDateString("id-ID",{day:"numeric",month:"short"}):"-"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-gray-200 bg-white flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Riwayat Pengeluaran"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Kelola dan pantau semua transaksi proyek"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full md:w-auto",children:[e.jsx(xe,{value:W,onChange:Y,placeholder:"Cari nota, barang...",className:"w-full sm:w-64"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:new URLSearchParams(window.location.search).get("expense_type_id")||"",onChange:t=>{const s=new URLSearchParams(window.location.search);t.target.value?s.set("expense_type_id",t.target.value):s.delete("expense_type_id"),S.get(`${window.location.pathname}?${s.toString()}`,{},{preserveState:!0,preserveScroll:!0})},className:"flex-1 sm:w-44 text-sm border-gray-200 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm py-2.5 bg-white",children:[e.jsx("option",{value:"",children:"Semua Tipe"}),l&&l.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg h-[45px] items-center",children:[e.jsx("button",{onClick:()=>U("transacted_at"),className:`px-3 py-1.5 text-xs font-bold rounded-md transition whitespace-nowrap ${j==="transacted_at"?"bg-white text-indigo-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Nota"}),e.jsx("button",{onClick:()=>U("created_at"),className:`px-3 py-1.5 text-xs font-bold rounded-md transition whitespace-nowrap ${j==="created_at"?"bg-white text-indigo-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Input"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipe Biaya"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Detail"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bukti"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:$.length>0?$.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 align-top",children:e.jsx("div",{className:"font-semibold text-gray-900",children:new Date(t[j]).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm align-top",children:t.expense_type?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200",children:t.expense_type.name}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"-"})}),e.jsxs("td",{className:"px-6 py-4 align-top",children:[e.jsx("div",{className:"font-bold text-indigo-700 mb-1",children:t.title}),t.items&&t.items.length>0?e.jsx("ul",{className:"text-sm text-gray-700 bg-gray-50 rounded-md p-2 space-y-1 border border-gray-100",children:t.items.map((s,o)=>e.jsxs("li",{className:"flex justify-between items-center border-b border-gray-100 last:border-0 pb-1 last:pb-0",children:[e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.quantity," ","x"," ",f(s.price),")"]})]}),e.jsx("span",{className:"font-medium text-gray-900 ml-4",children:f(s.total_price)})]},s.id||o))}):e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Tidak ada detail item."}),t.description&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 italic",children:['"',t.description,'"']})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center align-top",children:t.receipt_image?e.jsx("button",{onClick:()=>C(`/storage/${t.receipt_image}`),className:"text-indigo-600 hover:text-indigo-900 text-xs font-medium underline border border-indigo-200 rounded px-2 py-1 bg-indigo-50",children:"Lihat Foto"}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-gray-900 align-top",children:f(t.amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium align-top",children:!v&&e.jsxs("div",{className:"flex flex-col gap-2 align-end",children:[e.jsx("button",{onClick:()=>ae(t),className:"text-indigo-600 hover:text-indigo-900 bg-indigo-50 px-2 py-1 rounded hover:bg-indigo-100 text-xs text-center",children:"Edit"}),e.jsx("button",{onClick:()=>ne(t.id),className:"text-red-600 hover:text-red-900 bg-red-50 px-2 py-1 rounded hover:bg-red-100 text-xs text-center",children:"Hapus"})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:a.expenses.length>0?"Tidak ada data pengeluaran yang cocok dengan pencarian.":"Belum ada pengeluaran tercatat."})})})]})})]}),e.jsx(M,{show:h,onClose:()=>k(!1),maxWidth:"3xl",children:e.jsxs("form",{onSubmit:re,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Edit Data Proyek"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{value:"Nama Proyek"}),e.jsx(g,{value:r.data.name,onChange:t=>r.setData("name",t.target.value),className:"mt-1 block w-full",required:!0}),e.jsx(y,{message:r.errors.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Bendera (PT/CV)"}),e.jsxs("select",{value:r.data.bendera_id,onChange:t=>r.setData("bendera_id",t.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"-- Pilih Bendera --"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(y,{message:r.errors.bendera_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Status"}),e.jsxs("select",{value:r.data.status,onChange:t=>r.setData("status",t.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[e.jsx("option",{value:"ongoing",children:"Sedang Berjalan"}),e.jsx("option",{value:"completed",children:"Selesai"})]})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Lokasi Proyek"}),e.jsx(g,{value:r.data.location,onChange:t=>r.setData("location",t.target.value),className:"mt-1 block w-full",placeholder:"Jl. Sudirman No. 45"}),e.jsx(y,{message:r.errors.location,className:"mt-2"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{value:"Pelaksana (Multi-select)"}),e.jsx("div",{className:"mt-1 border border-gray-300 rounded-md p-2 max-h-40 overflow-y-auto bg-gray-50",children:n.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-1.5 hover:bg-gray-100 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.data.mandor_ids.includes(t.id),onChange:s=>{s.target.checked?r.setData("mandor_ids",[...r.data.mandor_ids,t.id]):r.setData("mandor_ids",r.data.mandor_ids.filter(o=>o!==t.id))},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.name})]},t.id))}),e.jsx(y,{message:r.errors.mandor_ids,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Koordinat Maps"}),e.jsx(g,{value:r.data.coordinates,onChange:t=>r.setData("coordinates",t.target.value),className:"mt-1 block w-full",placeholder:`6Â°52'09.6"S 109Â°02'34.5"E`}),e.jsx(y,{message:r.errors.coordinates,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Deskripsi"}),e.jsx("textarea",{value:r.data.description,onChange:t=>r.setData("description",t.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",rows:"3"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(q,{onClick:()=>k(!1),children:"Batal"}),e.jsx(J,{disabled:r.processing,children:r.processing?"Menyimpan...":"Simpan Perubahan"})]})]})}),e.jsx(M,{show:L,onClose:()=>u(!1),maxWidth:"4xl",children:e.jsxs("form",{onSubmit:se,className:"p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:p?"Edit Pengeluaran":"Catat Pengeluaran Baru"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx(c,{value:"Judul Nota / Toko"}),e.jsx(g,{value:d.title,onChange:t=>{m("title",t.target.value),T(!0)},className:"mt-1 block w-full",placeholder:"Cth: TB. Sinar Jaya"}),e.jsx(y,{message:_.title,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Tipe Biaya"}),e.jsxs("select",{value:d.expense_type_id,onChange:t=>m("expense_type_id",t.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"-- Pilih Tipe Biaya --"}),N&&N.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(y,{message:_.expense_type_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"Tanggal Transaksi"}),e.jsx(g,{type:"date",value:d.transacted_at,onChange:t=>m("transacted_at",t.target.value),className:"mt-1 block w-full",required:!0})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(c,{value:"Daftar Barang"}),e.jsx("button",{type:"button",onClick:Z,className:"text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-100 font-medium border border-indigo-200",children:"+ Tambah Item"})]}),e.jsx("div",{className:"space-y-3 bg-gray-50 p-3 rounded-lg border border-gray-200",children:d.items.map((t,s)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center bg-white p-2 rounded shadow-sm",children:[e.jsx("div",{className:"flex-1 w-full",children:e.jsx(g,{placeholder:"Nama Barang",value:t.name,onChange:o=>E(s,"name",o.target.value),className:"w-full text-sm",required:!0})}),e.jsx("div",{className:"w-20",children:e.jsx(g,{type:"number",placeholder:"Qty",value:t.quantity,onChange:o=>E(s,"quantity",parseInt(o.target.value)||0),className:"w-full text-sm text-center",min:"1",required:!0})}),e.jsx("div",{className:"w-32",children:e.jsx(g,{type:"number",placeholder:"Harga @",value:t.price,onChange:o=>E(s,"price",parseFloat(o.target.value)||0),className:"w-full text-sm text-right",min:"0",required:!0})}),e.jsx("div",{className:"w-32 text-right text-sm font-semibold text-gray-700 px-2",children:f(t.quantity*t.price)}),d.items.length>1&&e.jsx("button",{type:"button",onClick:()=>ee(s),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},s))}),_.items&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:_.items})]}),e.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-3 rounded-lg border border-indigo-100 mb-4",children:[e.jsx("span",{className:"font-semibold text-indigo-900",children:"Total Nota"}),e.jsx("span",{className:"text-xl font-bold text-indigo-700",children:f(X)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(c,{value:"Foto Struk (Opsional)"}),p&&!d.receipt_image&&e.jsx("p",{className:"text-xs text-gray-500 mb-1 italic",children:"*Biarkan kosong jika tidak ingin mengubah foto"}),e.jsx("input",{type:"file",onChange:t=>m("receipt_image",t.target.files[0]),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",accept:"image/*"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(c,{value:"Catatan Tambahan (Opsional)"}),e.jsx("textarea",{value:d.description,onChange:t=>m("description",t.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",rows:"2",placeholder:"Keterangan lain jika diperlukan..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 sticky bottom-0 bg-white pt-4 border-t border-gray-100",children:[e.jsx(q,{onClick:()=>u(!1),children:"Batal"}),e.jsx(J,{disabled:z,children:z?"Menyimpan...":p?"Simpan Perubahan":"Simpan Pengeluaran"})]})]})}),e.jsx(M,{show:!!D,onClose:()=>C(null),children:e.jsxs("div",{className:"p-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white z-10 pb-2",children:[e.jsx("h3",{className:"font-medium",children:"Bukti Transaksi"}),e.jsx("button",{type:"button",onClick:()=>C(null),className:"text-gray-400 hover:text-gray-600 text-2xl leading-none",children:"Ã—"})]}),D&&e.jsx("img",{src:D,alt:"Struk",className:"w-full h-auto max-h-[75vh] object-contain rounded-lg border border-gray-200"}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx(q,{onClick:()=>C(null),children:"Tutup"})})]})})]})}export{qe as default};
