import{r as x,u as W,j as e,H as U,L as $,c as N}from"./app-BqN6F9dy.js";import{B as G,S as w}from"./BendaharaLayout-D3ga0I3T.js";import{M as K}from"./Modal-C7ren_PA.js";import{I as c}from"./InputLabel-B-3BvCcX.js";import{T as u}from"./TextInput-Dke2LS8_.js";import{I as m}from"./InputError-BhlZm1d8.js";import{P as k}from"./PrimaryButton-DxBn27In.js";import{S as Y}from"./SecondaryButton-BwFT-TUm.js";/* empty css            */import"./ApplicationLogo-BCAV9GLV.js";import"./transition-C1YzXvQm.js";import"./with-selector-BF-W_PL3.js";function le({customer:n,transactions:_,grades:C=[],permissions:h={}}){const[L,B]=x.useState(!1),[l,I]=x.useState("bill"),[g,T]=x.useState(null),{data:r,setData:i,post:M,put:A,processing:S,errors:d,reset:y,clearErrors:F}=W({customer_id:n.id,date:new Date().toISOString().split("T")[0],description:"",grade:"",volume:"",price_per_m3:"",bill_amount:0,payment_amount:0,notes:""}),E=a=>{const t=a.target.value,b=C.find(p=>p.name===t);i(p=>({...p,grade:t,price_per_m3:b?b.price:p.price_per_m3}))};x.useEffect(()=>{if(l==="bill"){const a=parseFloat(r.volume)||0,t=parseFloat(r.price_per_m3)||0;i("bill_amount",a*t)}},[r.volume,r.price_per_m3,l]);const o=a=>!a||a===0?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),D=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),P=a=>a?new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",s=x.useMemo(()=>{let a=0;return _.map(t=>{const b=parseFloat(t.bill_amount)||0,p=parseFloat(t.payment_amount)||0;return a=a+b-p,{...t,runningBalance:a}})},[_]),j=x.useMemo(()=>s.length===0?0:s[s.length-1].runningBalance,[s]),f=(a,t=null)=>{I(a),T(t),B(!0),y(t?{customer_id:n.id,date:t.date,description:t.description,grade:t.grade||"",volume:t.volume||"",price_per_m3:t.price_per_m3||"",bill_amount:t.bill_amount,payment_amount:t.payment_amount,notes:t.notes||""}:{customer_id:n.id,date:new Date().toISOString().split("T")[0],description:a==="payment"?"Pembayaran":"",grade:"",volume:"",price_per_m3:"",bill_amount:0,payment_amount:0,notes:""}),F()},v=()=>{B(!1),T(null),y(),F()},H=a=>{a.preventDefault();const t=()=>v();g?A(route("receivable.transactions.update",g.id),{onSuccess:t}):M(route("receivable.transactions.store"),{onSuccess:t})},R=a=>{w.fire({title:"Apakah Anda yakin?",text:"Data transaksi ini akan dihapus permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(t=>{t.isConfirmed&&N.delete(route("receivable.transactions.destroy",a),{preserveScroll:!0})})},O=()=>{w.fire({title:"HAPUS CUSTOMER?",text:"PERINGATAN: Customer dan semua history transaksi akan dihapus permanen. Data tidak bisa dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"YA, HAPUS PERMANEN!",cancelButtonText:"Batal",focusCancel:!0}).then(a=>{a.isConfirmed&&N.delete(route("receivable.customers.destroy",n.id))})},V=()=>{w.fire({title:"RESET DATA CUSTOMER?",text:"Ini akan menghapus SEMUA transaksi dan mengosongkan nama customer. ID tetap dipertahankan.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#f59e0b",cancelButtonColor:"#3085d6",confirmButtonText:"YA, RESET DATA!",cancelButtonText:"Batal"}).then(a=>{a.isConfirmed&&N.post(route("customers.reset",n.id))})};return e.jsxs(G,{children:[e.jsx(U,{title:`Piutang - ${n.name}`}),e.jsxs("div",{className:"py-8 max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-gray-100 mb-8 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx($,{href:route("receivable.customers.index"),className:"p-2.5 bg-gray-50 rounded-xl text-gray-400 hover:text-indigo-600 transition-all border border-gray-100 group",children:e.jsx("svg",{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"bg-indigo-600 text-white text-[9px] font-black px-1.5 py-0.5 rounded shadow-sm tracking-tighter",children:["ID-",n.id]}),e.jsx("h1",{className:"text-2xl font-black text-gray-900 tracking-tight",children:n.name})]}),n.contact&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold text-gray-400 mt-0.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),n.contact]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 w-full md:w-auto justify-center md:justify-end",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50/80 px-4 py-2.5 rounded-2xl border border-gray-100 shadow-inner",children:[e.jsxs("div",{className:"flex flex-col items-end border-r border-gray-200 pr-4",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest leading-none mb-1",children:"Total Vol"}),e.jsxs("span",{className:"text-xl font-black text-emerald-600 tracking-tighter leading-none",children:[s.reduce((a,t)=>a+(parseFloat(t.volume)||0),0).toLocaleString("id-ID")," ",e.jsx("span",{className:"text-xs",children:"m³"})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest leading-none mb-1",children:"Sisa Hutang"}),e.jsx("span",{className:`text-xl font-black tracking-tighter leading-none ${j>0?"text-rose-600":"text-emerald-600"}`,children:o(j)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(auth.user.role==="superadmin"||auth.user.role==="bendahara_utama")&&e.jsxs("div",{className:"flex gap-1 border-r border-gray-100 pr-2 mr-1",children:[e.jsx("button",{onClick:V,className:"p-2 text-amber-500 hover:bg-amber-50 rounded-xl transition-colors border border-transparent hover:border-amber-100",title:"Reset",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{onClick:O,className:"p-2 text-rose-500 hover:bg-rose-50 rounded-xl transition-colors border border-transparent hover:border-rose-100",title:"Hapus",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx(k,{onClick:()=>f("payment"),className:"!bg-emerald-600 hover:!bg-emerald-700 !rounded-xl !py-2 !px-4 !text-xs !font-black !uppercase tracking-widest shadow-md",children:"+ Bayar"}),e.jsx(k,{onClick:()=>f("bill"),className:"!bg-indigo-600 hover:!bg-indigo-700 !rounded-xl !py-2 !px-4 !text-xs !font-black !uppercase tracking-widest shadow-md",children:"+ Tagih"})]})]})]}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl border border-gray-100",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-semibold border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 whitespace-nowrap",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 w-1/3",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-4 whitespace-nowrap text-center",children:"Mutu"}),e.jsx("th",{className:"px-4 py-4 whitespace-nowrap text-right",children:"Vol (m³)"}),e.jsx("th",{className:"px-4 py-4 whitespace-nowrap text-right",children:"Harga Satuan"}),e.jsx("th",{className:"px-6 py-4 whitespace-nowrap text-right text-gray-900 bg-gray-50",children:"Tagihan"}),e.jsx("th",{className:"px-6 py-4 whitespace-nowrap text-right text-green-700 bg-green-50",children:"Pembayaran"}),e.jsx("th",{className:"px-6 py-4 whitespace-nowrap text-right font-bold text-gray-800 bg-gray-50/30",children:"Sisa Hutang"}),e.jsx("th",{className:"px-4 py-4 whitespace-nowrap text-center text-gray-400",children:"#"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.length>0?s.map(a=>e.jsxs("tr",{className:`transition-colors group ${parseFloat(a.payment_amount)>0?"bg-green-50/50 hover:bg-green-50":"hover:bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-3 whitespace-nowrap font-medium text-gray-700",children:P(a.date)}),e.jsxs("td",{className:"px-6 py-3",children:[e.jsx("div",{className:"font-medium text-gray-800",children:a.description}),a.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-0.5 italic",children:a.notes})]}),e.jsx("td",{className:"px-4 py-3 text-center text-gray-600",children:a.grade||"-"}),e.jsx("td",{className:"px-4 py-3 text-right tabular-nums text-gray-600",children:a.volume?parseFloat(a.volume).toLocaleString("id-ID"):"-"}),e.jsx("td",{className:"px-4 py-3 text-right tabular-nums text-gray-600",children:o(a.price_per_m3)}),e.jsx("td",{className:"px-6 py-3 text-right tabular-nums font-bold text-gray-900",children:parseFloat(a.bill_amount)>0?o(a.bill_amount):"-"}),e.jsx("td",{className:"px-6 py-3 text-right tabular-nums font-bold text-green-600",children:parseFloat(a.payment_amount)>0?o(a.payment_amount):"-"}),e.jsx("td",{className:"px-6 py-3 text-right tabular-nums font-bold text-gray-800 bg-gray-50/30",children:o(a.runningBalance)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[h.can_update_transaction&&e.jsx("button",{onClick:()=>f(parseFloat(a.bill_amount)>0?"bill":"payment",a),className:"text-blue-500 hover:text-blue-700 p-1",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),h.can_delete_transaction&&e.jsx("button",{onClick:()=>R(a.id),className:"text-red-500 hover:text-red-700 p-1",title:"Hapus",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!h.can_update_transaction&&!h.can_delete_transaction&&e.jsx("span",{className:"text-[10px] text-gray-300 font-bold uppercase tracking-tighter italic",children:"Read Only"})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-6 py-12 text-center text-gray-400 bg-gray-50/50 italic",children:"Belum ada transaksi untuk customer ini."})})}),s.length>0&&e.jsx("tfoot",{className:"bg-gray-100 border-t border-gray-200 font-black",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"px-6 py-4 text-right text-gray-500 uppercase tracking-widest text-xs",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-4 text-right text-gray-900 border-l border-gray-200 bg-gray-50/50",children:s.reduce((a,t)=>a+(parseFloat(t.volume)||0),0).toLocaleString("id-ID")}),e.jsx("td",{className:"px-4 py-4"}),e.jsx("td",{className:"px-6 py-4 text-right text-gray-900 bg-gray-50",children:o(s.reduce((a,t)=>a+parseFloat(t.bill_amount),0))}),e.jsx("td",{className:"px-6 py-4 text-right text-green-700 bg-green-50/50",children:o(s.reduce((a,t)=>a+parseFloat(t.payment_amount),0))}),e.jsx("td",{className:"px-6 py-4 text-right text-gray-900 bg-gray-50/30",children:o(j)}),e.jsx("td",{})]})})]})})}),e.jsx(K,{show:L,onClose:v,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:g?`Edit ${l==="bill"?"Tagihan":"Pembayaran"}`:`Tambah ${l==="bill"?"Tagihan Baru":"Input Pembayaran"}`}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",value:"Tanggal"}),e.jsx(u,{id:"date",type:"date",name:"date",value:r.date,className:"mt-1 block w-full",onChange:a=>i("date",a.target.value)}),e.jsx(m,{message:d.date,className:"mt-2"})]}),l==="bill"&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"grade",value:"Mutu Beton"}),e.jsxs("select",{id:"grade",name:"grade",value:r.grade,onChange:E,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",children:[e.jsx("option",{value:"",children:"-- Pilih Mutu --"}),C.map(a=>e.jsxs("option",{value:a.name,children:[a.name," - ",D(a.price)]},a.id))]}),e.jsx(m,{message:d.grade,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",value:l==="bill"?"Keterangan / Lokasi":"Keterangan Pembayaran"}),e.jsx(u,{id:"description",type:"text",name:"description",value:r.description,className:"mt-1 block w-full",onChange:a=>i("description",a.target.value),placeholder:l==="bill"?"Cor Jalan Blok A":"Transfer BCA 01/02"}),e.jsx(m,{message:d.description,className:"mt-2"})]}),l==="bill"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"volume",value:"Volume (m³)"}),e.jsx(u,{id:"volume",type:"number",step:"0.01",name:"volume",value:r.volume,className:"mt-1 block w-full text-right",onChange:a=>i("volume",a.target.value),placeholder:"0.00"}),e.jsx(m,{message:d.volume,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"price_per_m3",value:"Harga Satuan (Rp)"}),e.jsx(u,{id:"price_per_m3",type:"number",name:"price_per_m3",value:r.price_per_m3,className:"mt-1 block w-full text-right",onChange:a=>i("price_per_m3",a.target.value),placeholder:"0"}),e.jsx(m,{message:d.price_per_m3,className:"mt-2"})]})]}),e.jsxs("div",{className:"bg-indigo-50 p-3 rounded-lg flex justify-between items-center border border-indigo-100",children:[e.jsx("span",{className:"text-sm font-medium text-indigo-800",children:"Total Tagihan"}),e.jsx("span",{className:"text-lg font-bold text-indigo-700",children:D(r.bill_amount)})]})]}):e.jsxs("div",{children:[e.jsx(c,{htmlFor:"payment_amount",value:"Nominal Pembayaran (Rp)"}),e.jsx(u,{id:"payment_amount",type:"number",name:"payment_amount",value:r.payment_amount,className:"mt-1 block w-full text-right text-lg font-bold text-green-700",onChange:a=>i("payment_amount",a.target.value),placeholder:"0"}),e.jsx(m,{message:d.payment_amount,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",value:"Catatan Tambahan (Opsional)"}),e.jsx("textarea",{id:"notes",name:"notes",value:r.notes,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",rows:"2",onChange:a=>i("notes",a.target.value)}),e.jsx(m,{message:d.notes,className:"mt-2"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(Y,{onClick:v,disabled:S,children:"Batal"}),e.jsx(k,{disabled:S,className:l==="bill"?"!bg-indigo-600 hover:!bg-indigo-700":"!bg-green-600 hover:!bg-green-700",children:g?"Simpan Perubahan":l==="bill"?"Simpan Tagihan":"Simpan Pembayaran"})]})]})]})})]})]})}export{le as default};
