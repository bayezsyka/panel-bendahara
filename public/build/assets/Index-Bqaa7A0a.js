import{a as H,r as m,u as K,j as e,H as F,L as C}from"./app-DDkThiwp.js";import{B as J}from"./BendaharaLayout-DkT6SKYz.js";import{P as O,B as w}from"./PageHeader-C2PkCXBo.js";import{M as R}from"./Modal-cheLN1Sv.js";import{I as o}from"./InputLabel-BYYSUQrg.js";import{T as g}from"./TextInput-cppD8dzz.js";import{P as p}from"./PrimaryButton-zZtWvJJz.js";import{S as q}from"./SecondaryButton-OFDyRyhG.js";import{I as c}from"./InputError-DtOQ83N4.js";import{S as A}from"./SearchInput-BTeeFBvO.js";import{E as G}from"./EmptyState-ZNLL9usH.js";import{S as L}from"./Select-BzXuO149.js";import{C as P}from"./Card-CtLf2Gfr.js";/* empty css            */import"./ApplicationLogo-0iz7Fc7z.js";import"./transition-BAZ8-2fJ.js";import"./with-selector-DBl-jayN.js";function ce({projects:_,mandors:B,benderas:S}){const{auth:M}=H().props,{can_manage_projects:u}=M,[E,i]=m.useState(!1),[x,k]=m.useState(!1),[f,v]=m.useState(null),[l,I]=m.useState(""),b=_.filter(a=>{const s=l.toLowerCase();return a.name.toLowerCase().includes(s)||a.description&&a.description.toLowerCase().includes(s)||a.location&&a.location.toLowerCase().includes(s)||a.bendera&&a.bendera.name.toLowerCase().includes(s)||a.mandors&&a.mandors.some(n=>n.name.toLowerCase().includes(s))}),{data:r,setData:t,post:z,put:D,processing:j,errors:d,reset:h,clearErrors:y}=K({name:"",description:"",status:"ongoing",coordinates:"",mandor_id:"",mandor_ids:[],bendera_id:"",location:""}),N=()=>{k(!1),v(null),h(),y(),i(!0)},T=a=>{k(!0),v(a);const s=a.mandors?a.mandors.map(n=>n.id):a.mandor_id?[a.mandor_id]:[];t({name:a.name,description:a.description||"",status:a.status,coordinates:a.coordinates||"",mandor_id:a.mandor_id||"",mandor_ids:s,bendera_id:a.bendera_id||"",location:a.location||""}),y(),i(!0)},W=a=>{if(a.preventDefault(),x){const s=f.slug||f.id;D(route("projectexpense.projects.update",s),{onSuccess:()=>{i(!1),h()}})}else z(route("projectexpense.projects.store"),{onSuccess:()=>{i(!1),h()}})};return e.jsxs(J,{children:[e.jsx(F,{title:"Proyek Konstruksi"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{title:"Proyek Konstruksi",backLink:route("projectexpense.overview"),backLabel:"Dashboard",actions:u&&e.jsx(p,{onClick:N,children:"+ Buat Proyek"})}),e.jsx(A,{value:l,onChange:I,placeholder:"Cari proyek berdasar nama, lokasi, bendera, atau pelaksana...",maxWidth:"max-w-lg"}),b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:b.map(a=>e.jsxs(P,{noPadding:!0,hover:!0,className:"group flex flex-col overflow-hidden",children:[e.jsxs(C,{href:route("projectexpense.projects.show",a.slug||a.id),className:"flex-1 p-5 block",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(w,{variant:a.status==="ongoing"?"blue":"green",size:"md",dot:!0,children:a.status==="ongoing"?"Berjalan":"Selesai"}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.created_at).toLocaleDateString("id-ID")})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1 group-hover:text-indigo-600 transition",children:a.name}),a.bendera&&e.jsxs(w,{variant:"purple",size:"sm",className:"mb-3",children:["ðŸ¢ ",a.bendera.name]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[a.mandors&&a.mandors.length>0?e.jsx("div",{className:"space-y-1.5",children:a.mandors.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 bg-gray-50 px-2 py-1.5 rounded-lg border border-gray-100",children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{className:"font-medium",children:["Pelaksana ",n+1,": ",s.name]})]},s.id))}):a.mandor&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 bg-gray-50 px-2 py-1.5 rounded-lg border border-gray-100",children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{className:"font-medium",children:["Pelaksana: ",a.mandor.name]})]}),(a.location||a.coordinates)&&e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500 px-2",children:[e.jsxs("svg",{className:"w-3.5 h-3.5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"line-clamp-1",children:a.location||"Lokasi Koordinat Tersedia"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2 mt-3 pt-3 border-t border-dashed border-gray-100",children:a.description||"Tidak ada deskripsi."})]}),e.jsxs("div",{className:"bg-gray-50 px-5 py-3 border-t border-gray-100 flex justify-between items-center",children:[e.jsx(C,{href:route("projectexpense.projects.show",a.slug||a.id),className:"text-xs font-medium text-gray-600 hover:text-indigo-600 transition-colors",children:"Lihat Detail"}),u&&e.jsxs("button",{onClick:s=>{s.preventDefault(),T(a)},className:"text-xs font-medium text-indigo-600 hover:text-indigo-800 flex items-center gap-1 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit Proyek"]})]})]},a.id))}):e.jsx(P,{children:e.jsx(G,{title:l?`Tidak ada hasil untuk "${l}"`:"Belum ada proyek",description:l?"Coba kata kunci lain.":"Buat proyek pertama untuk memulai pencatatan biaya.",action:!l&&u?e.jsx(p,{onClick:N,children:"+ Buat Proyek"}):null})})]}),e.jsx(R,{show:E,onClose:()=>i(!1),children:e.jsxs("form",{onSubmit:W,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:x?"Edit Proyek":"Buat Proyek Baru"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Nama Proyek"}),e.jsx(g,{value:r.name,onChange:a=>t("name",a.target.value),className:"mt-1 block w-full",placeholder:"Contoh: Renovasi Gedung A",autoFocus:!0,required:!0}),e.jsx(c,{message:d.name,className:"mt-2"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(o,{value:"Bendera (PT/CV)"}),e.jsx(L,{className:"mt-1",value:r.bendera_id,onChange:a=>t("bendera_id",a.target.value),placeholder:"-- Pilih Bendera --",options:S.map(a=>({value:a.id,label:a.name}))}),e.jsx(c,{message:d.bendera_id,className:"mt-2"})]})}),e.jsxs("div",{children:[e.jsx(o,{value:"Pelaksana (Bisa Pilih Lebih dari 1)"}),e.jsx("div",{className:"mt-1 border border-gray-200 rounded-lg p-2 max-h-32 overflow-y-auto bg-gray-50",children:B.map(a=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:r.mandor_ids.includes(a.id),onChange:s=>{s.target.checked?t("mandor_ids",[...r.mandor_ids,a.id]):t("mandor_ids",r.mandor_ids.filter(n=>n!==a.id))},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[a.name," (",a.whatsapp_number,")"]})]},a.id))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Pilih satu atau lebih pelaksana untuk proyek ini"}),e.jsx(c,{message:d.mandor_ids,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Lokasi Proyek (Teks)"}),e.jsx(g,{value:r.location,onChange:a=>t("location",a.target.value),className:"mt-1 block w-full",placeholder:"Contoh: Jl. Sudirman No. 45, Jakarta"}),e.jsx(c,{message:d.location,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Koordinat Maps (Opsional)"}),e.jsx(g,{value:r.coordinates,onChange:a=>t("coordinates",a.target.value),className:"mt-1 block w-full",placeholder:"Contoh: -6.1234, 106.1234"}),e.jsx(c,{message:d.coordinates,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Deskripsi (Opsional)"}),e.jsx("textarea",{value:r.description,onChange:a=>t("description",a.target.value),className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm text-sm",rows:"2",placeholder:"Catatan tambahan..."})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Status Proyek"}),e.jsx(L,{className:"mt-1",value:r.status,onChange:a=>t("status",a.target.value),placeholder:"",options:[{value:"ongoing",label:"Sedang Berjalan"},{value:"completed",label:"Selesai (Completed)"}]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(q,{onClick:()=>i(!1),children:"Batal"}),e.jsx(p,{disabled:j,children:j?"Menyimpan...":x?"Simpan Perubahan":"Buat Proyek"})]})]})})]})}export{ce as default};
